<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Detail Video</title>

<link rel="stylesheet" href="https://cdn.plyr.io/3.7.8/plyr.css"/>

<style>
body{
  margin:0;
  background:#0f0f0f;
  font-family:Arial;
  color:white;
}

.container{
  max-width:1100px;
  margin:auto;
  padding:20px;
}

.video-wrapper{
  position:relative;
  width:100%;
  background:#000;
  border-radius:12px;
  overflow:hidden;
}

/* Video ikut rasio asli */
#player{
  width:100%;
  height:auto;
  max-height:80vh;
  display:none;
}

/* Thumbnail ikut rasio asli */
.video-wrapper img{
  width:100%;
  height:auto;
  display:block;
}

.video-wrapper img{
  width:100%;
  height:100%;
  object-fit:cover;
}

.play-btn{
  position:absolute;
  top:50%;
  left:50%;
  transform:translate(-50%, -50%);
  width:80px;
  height:80px;
  background:rgba(0,0,0,0.6);
  border-radius:50%;
  display:flex;
  align-items:center;
  justify-content:center;
  cursor:pointer;
  transition:0.3s;
  z-index:10;
}

.play-btn:hover{
  background:red;
}

.play-btn::before{
  content:'';
  border-style:solid;
  border-width:15px 0 15px 25px;
  border-color:transparent transparent transparent white;
  margin-left:5px;
}

#player{
  width:100%;
  height:100%;
  display:none;
}

.title{
  margin-top:15px;
  font-size:22px;
  font-weight:bold;
}

.recommend-section{
  margin-top:40px;
}

.recommend-title{
  font-size:18px;
  margin-bottom:15px;
}

.recommend-grid{
  display:grid;
  grid-template-columns:repeat(auto-fill, minmax(240px,1fr));
  gap:15px;
}

.recommend-card{
  background:#181818;
  border-radius:10px;
  overflow:hidden;
  cursor:pointer;
  transition:0.3s;
}

.recommend-card:hover{
  transform:translateY(-4px);
}

.recommend-card img{
  width:100%;
  aspect-ratio:16/9;
  object-fit:cover;
}

.recommend-card .rec-title{
  padding:10px;
  font-size:14px;
}
</style>
</head>
<body>

<div class="container">

  <div class="video-wrapper">
    <img id="thumb">
    <div class="play-btn" id="playBtn"></div>

    <video id="player" playsinline></video>
  </div>

  <div class="title" id="title"></div>

  <div class="recommend-section">
    <div class="recommend-title">Rekomendasi Video</div>
    <div class="recommend-grid" id="recommendGrid"></div>
  </div>

</div>

<!-- LOAD PLYR JS DULU -->
<script src="https://cdn.plyr.io/3.7.8/plyr.polyfilled.js"></script>

<script>
document.addEventListener("contextmenu", e => e.preventDefault());

const params = new URLSearchParams(window.location.search);
const videoId = params.get("id");

let allVideos = [];
let player;

fetch('videos.json')
.then(res => res.json())
.then(data => {

  allVideos = data;

  const video = data.find(v => v.id === videoId);

  if(!video){
    document.body.innerHTML = "Video tidak ditemukan";
    return;
  }

  document.getElementById("title").innerText = video.title;
  document.getElementById("thumb").src = video.thumbnail;

  const videoElement = document.getElementById("player");
  videoElement.src = video.video;

  /* INIT PLYR SETELAH SRC ADA */
  player = new Plyr('#player', {
    controls: [
      'play-large',
      'play',
      'progress',
      'current-time',
      'mute',
      'volume',
      'fullscreen'
    ],
    settings: []
  });

  loadRecommendations(videoId);
});

/* PLAY BUTTON */
document.getElementById("playBtn").addEventListener("click", function(){

  const video = document.getElementById("player");

  video.style.display="block";
  document.getElementById("thumb").style.display="none";
  this.style.display="none";

  player.play();
});

/* REKOMENDASI */
function loadRecommendations(currentId){

  const grid = document.getElementById("recommendGrid");
  grid.innerHTML="";

  const filtered = allVideos.filter(v => v.id !== currentId);
  const shuffled = filtered.sort(() => 0.5 - Math.random());
  const selected = shuffled.slice(0,4);

  selected.forEach(video => {

    const card = document.createElement("div");
    card.className="recommend-card";
    card.onclick=()=>{
      window.location.href="detail.html?id="+video.id;
    };

    card.innerHTML=`
      <img src="${video.thumbnail}">
      <div class="rec-title">${video.title}</div>
    `;

    grid.appendChild(card);
  });
}
player.on('ready', () => {

  const video = player.media;

  const ratio = video.videoWidth / video.videoHeight;

  const wrapper = document.querySelector('.video-wrapper');

  if(ratio < 1){
    // PORTRAIT
    wrapper.style.maxWidth = "420px";
    wrapper.style.margin = "0 auto";
  } else {
    // LANDSCAPE
    wrapper.style.maxWidth = "100%";
  }

});
</script>

</body>
</html>
